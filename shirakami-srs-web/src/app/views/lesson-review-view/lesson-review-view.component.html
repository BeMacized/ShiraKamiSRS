<div class="view-container">
    <div class="top-pane">
        <div class="progress-bar">
            <div class="progress-bar-inner">
                <div
                    class="progress-bar-fill"
                    [style.width]="progressBarWidth"
                ></div>
            </div>
        </div>
        <div class="content" *ngIf="page">
            <div class="content-inner" *ngIf="page.type === 'LESSON'">
                <div
                    [fittext]="true"
                    [maxFontSize]="50"
                    [modelToWatch]="page"
                    class="fit-text"
                >
                    <div class="line line-header">Lesson</div>
                    <ng-container *ngIf="lessonStage === 'ENGLISH'">
                        <ng-container
                            *ngFor="
                                let translation of page.card.value
                                    .enTranslations;
                                let last = last;
                                let count = count
                            "
                        >
                            <div class="line line-vocab">
                                {{ translation }}
                            </div>
                            <div
                                class="line line-or"
                                *ngIf="count > 1 && !last"
                            >
                                or
                            </div>
                        </ng-container>
                    </ng-container>
                    <ng-container *ngIf="lessonStage === 'JAPANESE'">
                        <ng-container
                            *ngFor="
                                let translation of page.card.value
                                    .jpTranslations;
                                let last = last;
                                let count = count
                            "
                        >
                            <div
                                class="line line-vocab-furigana"
                                *ngIf="translation[1]"
                            >
                                {{ translation[0] }}
                            </div>
                            <div class="line line-vocab">
                                {{ translation[1] || translation[0] }}
                            </div>
                            <div
                                class="line line-or"
                                *ngIf="count > 1 && !last"
                            >
                                or
                            </div>
                        </ng-container>
                    </ng-container>
                </div>
                <div class="lesson-lang-indicator">
                    <button
                        class="lesson-lang-indicator-lang en"
                        [class.active]="lessonStage === 'ENGLISH'"
                        (click)="lessonStage = 'ENGLISH'"
                    >
                        <span class="flag-icon flag-icon-gb"></span>
                        <span>English</span>
                    </button>
                    <button
                        class="lesson-lang-indicator-lang jp"
                        [class.active]="lessonStage === 'JAPANESE'"
                        (click)="lessonStage = 'JAPANESE'"
                    >
                        <span class="flag-icon flag-icon-jp"></span>
                        <span>Japanese</span>
                    </button>
                </div>
            </div>
            <div class="content-inner" *ngIf="page.type === 'LESSON_INPUT'">
                <div
                    [fittext]="true"
                    [maxFontSize]="50"
                    [modelToWatch]="page"
                    class="fit-text"
                >
                    <!--TODO-->
                </div>
            </div>
        </div>
        <div class="top-bar">
            <div class="left">
                <button class="btn action" [routerLink]="['dashboard']">
                    <i class="material-icons">home</i>
                </button>
            </div>
            <div class="right">
                <span
                    class="counter"
                    @fade
                    *ngIf="['LESSON_INPUT'].includes(page?.type)"
                >
                    <i class="material-icons">check</i>{{ itemsCorrect }} /
                    {{ itemsInSession }}
                </span>
                <span
                    class="counter"
                    @fade
                    *ngIf="['LESSON_INPUT', 'LESSON'].includes(page?.type)"
                >
                    <i class="material-icons">inbox</i>{{ totalItemsRemaining }}
                </span>
            </div>
        </div>
    </div>
    <div class="bottom-pane">
        <div class="info-bar">
            <ng-container *ngIf="page">
                <ng-container *ngIf="page.type === 'LESSON'">
                    <div class="info-bar-lessons">
                        <button
                            class="btn info-bar-lesson"
                            [class.active]="page === lesson"
                            *ngFor="
                                let lesson of pages
                                    | filterBy: ['type']:'LESSON':true;
                                let index = index
                            "
                            (click)="
                                goToLesson(index); lessonIndexButton.blur()
                            "
                            #lessonIndexButton
                        >
                            {{ index + 1 }}
                        </button>
                    </div>
                    <button
                        class="btn btn-transparent btn-lesson-next"
                        (click)="nextLesson()"
                    >
                        <i class="material-icons">arrow_forward_ios</i>
                    </button>
                </ng-container>
                <ng-container
                    *ngIf="
                        page.type === 'REVIEW' || page.type === 'LESSON_INPUT'
                    "
                >
                    <ng-container *ngIf="page.mode === 'enToJp'">
                        <span class="flag-icon flag-icon-gb"></span>
                        <i class="material-icons">arrow_forward</i>
                        <span class="flag-icon flag-icon-jp"></span>
                    </ng-container>
                    <ng-container *ngIf="page.mode === 'jpToEn'">
                        <span class="flag-icon flag-icon-jp"></span>
                        <i class="material-icons">arrow_forward</i>
                        <span class="flag-icon flag-icon-gb"></span>
                    </ng-container>
                    <ng-container *ngIf="page.mode === 'kanjiToKana'">
                        <span>漢字</span>
                        <i class="material-icons">arrow_forward</i>
                        <span>かな</span>
                    </ng-container>
                </ng-container>
            </ng-container>
        </div>
        <div
            class="input-bar"
            *ngIf="['LESSON_INPUT', 'REVIEW'].includes(page?.type)"
            [class.success]="
                inputStage === 'FEEDBACK' && inputFeedback === 'CORRECT'
            "
            [class.failure]="
                inputStage === 'FEEDBACK' && inputFeedback === 'INCORRECT'
            "
            @hshrink
        >
            <input
                type="text"
                class="input animate__animated"
                placeholder="Your Response"
                [class.animate__shakeX]="shakeInputAnimation"
                [style.--animate-duration]="'0.5s'"
                #answerInput
                [wanakana]="enableIME"
                (wkInput)="answer = $event"
                [readOnly]="inputStage === 'FEEDBACK'"
            />
            <button
                class="btn btn-rect btn-transparent btn-submit"
                (click)="onEnterKey()"
            >
                <i class="material-icons">arrow_forward_ios</i>
            </button>
        </div>
    </div>
</div>
