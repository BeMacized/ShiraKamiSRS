<div class="modal-bg" @bg @triggerModal>
    <div
        class="modal modal-md"
        @modal
        (clickOutside)="close()"
        [smoothHeight]="page"
    >
        <div class="modal-page" *ngIf="page === 'NAME'" @modalPage>
            <div class="modal-header">
                <h1>Create a new set</h1>
            </div>
            <div class="modal-content ai-center">
                <input
                    class="input input-large"
                    type="text"
                    placeholder="Set name"
                    [(ngModel)]="setName"
                    maxlength="128"
                    (keyup.enter)="isSetNameValid && goToPage('MODES')"
                    #nameInput
                />
            </div>
            <div class="modal-actions">
                <button class="button btn btn-secondary" (click)="close()">
                    Cancel
                </button>
                <button
                    class="button btn btn-primary"
                    [disabled]="!isSetNameValid"
                    (click)="goToPage('MODES')"
                >
                    Next
                </button>
            </div>
        </div>
        <div class="modal-page" *ngIf="page === 'MODES'" @modalPage>
            <div class="modal-header">
                <h1>Create a new set</h1>
            </div>
            <div class="modal-content ai-center">
                <p>
                    Select which modes you want to practice this set set for.
                    You can always change this later.
                </p>
                <div class="set-modes">
                    <button
                        class="set-mode"
                        [class.active]="modes.includes('jpToEn')"
                        (click)="toggleMode('jpToEn')"
                    >
                        <div class="set-mode-icon">
                            <span class="flag-icon flag-icon-jp"></span>
                            <i class="material-icons">arrow_forward</i>
                            <span class="flag-icon flag-icon-gb"></span>
                        </div>
                        <div class="set-mode-title">
                            Translate from Japanese
                        </div>
                    </button>
                    <button
                        class="set-mode"
                        [class.active]="modes.includes('enToJp')"
                        (click)="toggleMode('enToJp')"
                    >
                        <div class="set-mode-icon">
                            <span class="flag-icon flag-icon-gb"></span>
                            <i class="material-icons">arrow_forward</i>
                            <span class="flag-icon flag-icon-jp"></span>
                        </div>
                        <div class="set-mode-title">
                            Translate into Japanese
                        </div>
                    </button>
                    <button
                        class="set-mode"
                        [class.active]="modes.includes('kanjiToKana')"
                        (click)="toggleMode('kanjiToKana')"
                    >
                        <div class="set-mode-icon">
                            <span>漢字</span>
                            <i class="material-icons">arrow_forward</i>
                            <span>かな</span>
                        </div>
                        <div class="set-mode-title">Learn Kanji Readings</div>
                    </button>
                </div>
                <div
                    class="alert alert-warning"
                    style='margin-top: 1em'
                    *ngIf="!areSetModesValid"
                    @vshrink
                >
                    You need to have at least one mode active.
                </div>
            </div>
            <div class="modal-actions">
                <button class="button btn btn-secondary" (click)="close()">
                    Cancel
                </button>
                <button
                    class="button btn btn-secondary"
                    (click)="goToPage('NAME')"
                >
                    Back
                </button>
                <button
                    class="button btn btn-primary"
                    [disabled]="!areSetModesValid"
                    (click)="createSet()"
                >
                    Create
                </button>
            </div>
        </div>
        <div class="modal-page" *ngIf="page === 'CREATING'" @modalPage>
            <div class="modal-header">
                <h1>Create a new set</h1>
            </div>
            <div class="modal-content ai-center no-padding" [smoothHeight]='creationStatus'>
                <div
                    @crossFade
                    class="status-container"
                    *ngIf="creationStatus === 'IN_PROGRESS'"
                >
                    <app-spinner size="NORMAL"></app-spinner>
                    <span class='status-message'>
                        Creating Set...
                    </span>
                </div>
                <div
                    @crossFade
                    class="status-container"
                    *ngIf="creationStatus === 'ERROR'"
                >
                    <i class="material-icons error-icon">error_outline</i>
                    <span class='status-message'>
                        {{ errorMessage }}
                    </span>
                </div>
                <div
                    @crossFade
                    class="status-container"
                    *ngIf="creationStatus === 'SUCCESS'"
                >
                    <i class="material-icons success-icon">check_circle_outline</i>
                    <span class='status-message'>
                        <span>Set '{{setName}}' created successfully!</span>
                    </span>
                </div>
            </div>
            <div class="modal-actions">
                <button
                    class="button btn btn-secondary"
                    (click)="createSet()"
                    *ngIf="creationStatus === 'ERROR'"
                    @hshrink
                >
                    Retry
                </button>
                <button
                    class="button btn btn-secondary"
                    (click)="close()"
                    [disabled]="creationStatus === 'IN_PROGRESS'"
                    @hshrink
                >
                    Close
                </button>
            </div>
        </div>
    </div>
</div>
